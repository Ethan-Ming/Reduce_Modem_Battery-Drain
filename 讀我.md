# README-ZH.MD

## RMBD（去TM的多播锁）
      

本仓库包含 **两个 Magisk 模块**，用于降低 Android 设备在**待机 / 锁屏状态下**，因**无线局域网多播流量**导致的异常耗电，

这两个模块通过控制 **无线网络接口的 multicast 标志位** 来工作，该标志位会直接影响：

- 锁屏状态下的wakelock频率
    
- Doze 強制被中斷
- 待机功耗

---

## 背景说明（为什么要做这个）

很多应用（如系统服务、应用商店、微信等即时通讯、社交媒体、媒体类应用等）  
**长期、不必要地持有多播锁**。

这会导致：

- 锁屏状态下耗电异常偏高  
- CPU 与无线射频频繁被拉出 suspend  
- `WifiMulticastOn` 长时间处于开启状态（数小时级别）  
- 无线驱动频繁中断唤醒（`dhdpcie_host_wake`）

⚠️ 注意一个常见误区：  
**电池统计中“WI-FI佔用很少”并不代表问题不大**。

多播带来的真正消耗，往往被记入：
- CPU 运行时间
- 内核唤醒
- 调制解调器 / 无线基带
- Doze 失败与提前退出

Android 系统本身**并不会主动严格限制多播的使用**，  
这些模块的目的就是补上这一缺口。

---

## 模块说明

### 1️⃣ RMBD（强制关闭版）

**适合人群：**  
追求极致待机时长，几乎不使用设备发现功能的用户

#### 工作方式
- 全局关闭无线接口的 multicast
- 只要模块处于启用状态，多播始终关闭
- 需要重启生效
- 启用期间，设备发现功能（Chromecast、mDNS、UPnP 等）将不可用

#### 行为表

| 状态 | 多播 |
|----|----|
| 开机 | 关闭 |
| 亮屏 | 关闭 |
| 锁屏 | 关闭 |

#### 优点
- 待机功耗下降最明显
- 实现简单、稳定
- 无后台逻辑、零轮询

#### 缺点
- 无法使用 Chromecast / 智能设备发现， 需要使用時手動開關

---

### 2️⃣ RMBD_screen_aware（推荐，大多数用户适合）

**适合人群：**  
经常使用 Chromecast / 智能家居，但又在意待机耗电的用户

#### 工作方式
- **锁屏时自动关闭多播**
- **亮屏时自动恢复多播**
- 无需手动切换
- 实际使用设备时，发现功能完全正常

#### 行为表

| 屏幕状态 | 多播 | 设备发现 |
|--------|------|--------|
| 亮屏 | 开启 | 正常 |
| 锁屏 | 关闭 | 停用 |

#### 优点
- 明显降低锁屏耗电
- 不影响日常投屏 / 配网
- 全自动，无需记得开关

#### 缺点
- 節電能力稍弱

---

## 我该选哪个？

| 使用场景 | 推荐模块 |
|------|------|
| 极致省电 | **RMBD** |
| 常用 Chromecast / 智能家居 | **RMBD_screen_aware** |
| 手机大多数时间锁屏 | **两者都合适** |
| 不想手动管理 | **RMBD_screen_aware** |

---

## 安装方法

### 前置条件
- 已 Root 的 Android 设备
- 已安装 Magisk (v21+)

### 安装步骤
1. 下载所需模块 ZIP：
   - `RMBD.zip` —— 最大化省电  
   **或**
   - `RMBD_screen_aware.zip` —— 略微牺牲一点点省电，换取完整设备发现体验
2. 打开 **Magisk**
3. 进入 **模块 → 从本地安装**
4. 选择 ZIP 文件
5. 重启设备

---

## 验证方式（可选）

```bash
adb shell su -c "ip link show wlan0 | grep MULTICAST"
```
应 无任何输出。
